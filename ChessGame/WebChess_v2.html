<!DOCTYPE html>
<html>
<head>
   <title>Chess Game</title>
   <link rel="stylesheet" href="index.css">
   <link rel="stylesheet" href="highlight.css">

   <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/Logo/chessGame_v2/apple-touch-icon.png">
   <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/Logo/chessGame_v2/favicon-32x32.png">
   <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/Logo/chessGame_v2/favicon-16x16.png">
   <link rel="manifest" href="../assets/images/Logo/chessGame_v2/site.webmanifest">

   <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<!-- ðŸ”’ Password Login -->
<div id="loginBox" style="text-align:center; margin-top:100px;">
  <h2>Enter Game Password</h2>
  <input type="password" id="gamePassword" placeholder="Enter password">
  <button onclick="checkPassword()">Enter</button>
  <p id="loginMessage" style="color:red; display:none;">Wrong password. Try again.</p>
</div>

<!-- Main game container hidden until login -->
<div id="mainGame" style="display:none;">
  <div class="container">
    <!-- Chess board -->
    <div id="board"></div>

    <!-- Move records -->
    <div id="moves">
      <div id="controls">
        <button onclick="downloadMoves()">Save</button><br>
        <button onclick="copyMoves()">Copy</button>
        <button onclick="undoMove()">Undo</button>
        <button onclick="resetGame()">Reset</button>
      </div>

      <h2>Moves</h2>
      <ss>Version 2</ss>
      <div id="turnDisplay"><strong>Turn:</strong> White</div>
      <div id="status"></div>

      <ol id="moveList"></ol>  

      <!-- Room controls -->
      <div id="roomControls">
        <div id="topControl">
          <select id="roomSelect"></select>
          <select id="colorSelect">
            <option value="w">White</option>
            <option value="b">Black</option>
          </select>
        </div>
        <div id="botControl">
          <button onclick="createRoom()">Create Room</button>
          <button onclick="joinRoom()">Join Room</button>
          <!-- <button onclick="deleteRoom()">Delete Room</button> -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JS Libraries -->
<script src="chess.min.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCy51Cw8ER-6I2sEDdg4O2fGiEaag2T__A",
    authDomain: "webchess-a82bf.firebaseapp.com",
    projectId: "webchess-a82bf",
    storageBucket: "webchess-a82bf.firebasestorage.app",
    messagingSenderId: "331279918340",
    appId: "1:331279918340:web:d6a1aaea49c1323aa99c51",
    measurementId: "G-VF1Q30S3QJ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // âœ… Password login using /accessKey in Firebase
  function checkPassword() {
    const input = document.getElementById("gamePassword").value;
    const msg = document.getElementById("loginMessage");

    db.ref("accessKey").once("value")
      .then(snapshot => {
        const correctPassword = snapshot.val();
        if (input === correctPassword) {
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("mainGame").style.display = "block";
          localStorage.setItem("chessAuth", "true"); // optional auto-login
        } else {
          msg.style.display = "block";
        }
      })
      .catch(err => {
        console.error("Firebase read error:", err);
        alert("Error checking password. Check console.");
      });
  }

  // Auto-login if previously authenticated
  window.addEventListener("load", () => {
    if (localStorage.getItem("chessAuth") === "true") {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("mainGame").style.display = "block";
    }
  });
</script>

<!-- Your game logic -->
<script src="highlight.js"></script>
<script src="room_v2.js"></script>
<script src="ChessGame_v2.js"></script>

</body>
</html>
